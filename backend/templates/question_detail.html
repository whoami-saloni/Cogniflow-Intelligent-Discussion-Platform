{% extends "base.html" %}
{% block content %}
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="text-xl font-bold">{{ question.title }}</h2>
    <div class="prose max-w-none">{{ question.description | safe }}</div>
    <p class="text-sm text-gray-500">Asked by {{ question.user.username }} at {{ question.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
  </div>

  <h3 class="text-lg font-semibold mb-2">Answers</h3>
  {% for a in question.answers %}
    <div class="bg-gray-100 p-3 rounded mb-3">
      <p>{{ a.content | safe }}</p>
      <p class="text-sm text-gray-500">By {{ a.user.username }} at {{ a.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
      <div class="flex space-x-2 items-center mt-2">
        <form method="POST" action="/answers/{{ a.id }}/vote">
          <input type="hidden" name="type" value="up">
          <button class="text-green-600">⬆ Upvote</button>
        </form>
        <form method="POST" action="/answers/{{ a.id }}/vote">
          <input type="hidden" name="type" value="down">
          <button class="text-red-600">⬇ Downvote</button>
        </form>
        {% if question.user.id == session['user_id'] and not a.is_accepted %}
          <form method="POST" action="/questions/{{ question.id }}/accept/{{ a.id }}">
            <button class="text-blue-600">✔ Accept Answer</button>
          </form>
        {% elif a.is_accepted %}
          <span class="text-green-600 font-bold">✔ Accepted</span>
        {% endif %}
      </div>
    </div>
  {% else %}
    <p>No answers yet.</p>
  {% endfor %}

  {% if username %}
  <h4 class="text-lg font-bold mt-6">Your Answer</h4>
  <form method="POST">
    <div id="answer-editor" class="bg-white p-2 border h-40 mb-2"></div>
    <input type="hidden" name="content" id="answer-content">
    <button class="bg-green-500 text-white px-4 py-2 rounded">Submit Answer</button>
  </form>

  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/quill-emoji@0.1.7/dist/quill-emoji.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quill-emoji@0.1.7/dist/quill-emoji.min.js"></script>
  <script>
    var answerQuill = new Quill('#answer-editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          [{ 'header': [1, 2, 3, false] }],
          ['bold', 'italic', 'strike'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'align': [] }],
          ['link', 'image'],
          ['emoji'],
          ['clean']
        ],
        'emoji-toolbar': true,
        'emoji-textarea': false,
        'emoji-shortname': true
      }
    });

    document.querySelector('form').onsubmit = function () {
      document.querySelector('#answer-content').value = answerQuill.root.innerHTML;
    };
  </script>
  {% else %}
    <p class="text-blue-600">Please <a href="/login">log in</a> to answer.</p>
  {% endif %}
{% endblock %}
